# 网页端改进说明文档

## 一、后端 API 接口调用说明

### 1.1 预约相关 API

**新建文件：`api/booking.ts`**

- `POST /api/v1/bookings` - 创建预约
    - 参数：`{ venueId: number, courseId?: number, bookingTime: string }`
    - 返回：`Result<number>` (bookingId)

- `GET /api/v1/bookings/my` - 获取我的预约列表
    - 返回：`Result<BookingVO[]>`

- `GET /api/v1/bookings/venue/{venueId}` - 获取场馆预约列表（管理员）
    - 返回：`Result<BookingVO[]>`

- `GET /api/v1/bookings/{bookingId}` - 获取预约详情
    - 返回：`Result<BookingVO>`

- `PUT /api/v1/bookings/{bookingId}/status` - 更新预约状态
    - 参数：`{ status: number }`
    - 返回：`Result<null>`

- `DELETE /api/v1/bookings/{bookingId}` - 取消预约
    - 返回：`Result<null>`

**数据模型：**
- `BookingCreateParams`: venueId, courseId?, bookingTime
- `BookingVO`: bookingId, userId, venueId, venueName, courseId?, courseTitle?, bookingTime, status, createdAt

### 1.2 评价相关 API

**新建文件：`api/review.ts`**

**课程评价：**
- `POST /api/v1/courses/{courseId}/reviews` - 创建课程评价
    - 参数：`{ rating: number (1-5), content?: string }`
    - 返回：`Result<number>` (reviewId)

- `GET /api/v1/courses/{courseId}/reviews` - 获取课程评价列表
    - 参数：`page`, `size` (查询参数)
    - 返回：`Result<CourseReviewVO[]>`

- `GET /api/v1/courses/{courseId}/reviews/my` - 获取我的评价
    - 返回：`Result<CourseReviewVO>`

- `DELETE /api/v1/courses/{courseId}/reviews/{reviewId}` - 删除评价
    - 返回：`Result<null>`

**场馆评价：**
- `POST /api/v1/venues/{venueId}/reviews` - 创建场馆评价
- `GET /api/v1/venues/{venueId}/reviews` - 获取场馆评价列表
- `GET /api/v1/venues/{venueId}/reviews/my` - 获取我的评价
- `DELETE /api/v1/venues/{venueId}/reviews/{reviewId}` - 删除评价

**数据模型：**
- `CourseReviewVO`: reviewId, userId, userNickname, userAvatar?, courseId, rating, content?, createdAt
- `VenueReviewVO`: 类似结构，venueId 替代 courseId

### 1.3 课程推荐 API

**修改文件：`api/course.ts`**

- `GET /api/v1/courses/popular` - 获取热门课程
    - 参数：`limit` (查询参数，默认10)
    - 返回：`Result<CourseVO[]>`

- `GET /api/v1/courses/recommended` - 获取推荐课程
    - 参数：`limit` (查询参数，默认10)
    - 返回：`Result<CourseVO[]>`

- `GET /api/v1/courses/my/managed` - 获取我管理的课程（管理员）
    - 返回：`Result<CourseVO[]>`

### 1.4 数据模型更新

**修改文件：`api/model/courseModel.ts`**
- `CourseVO` 新增字段：description?, coverImage?, status?, rating?, reviewCount?, studentCount?

**修改文件：`api/model/venueModel.ts`**
- `VenueVO` 新增字段：description?, coverImage?, reviewCount?

### 1.5 运动成就 API

**新建文件：`api/achievement.ts`**

- `GET /api/v1/achievements/my` - 获取我的运动成就
    - 返回：`Result<AchievementVO>`

**数据模型：**
- `AchievementVO`: totalDistance, completedCourses, consecutiveDays, totalPoints, currentPoints

### 1.6 积分体系 API

**新建文件：`api/point.ts`**

- `GET /api/v1/points/records` - 获取积分记录
    - 参数：`type?`, `startDate?`, `endDate?` (查询参数)
    - 返回：`Result<PointRecordVO[]>`

- `GET /api/v1/points/rules` - 获取积分规则
    - 返回：`Result<PointRuleVO>`

**数据模型：**
- `PointRecordVO`: recordId, points, type, typeName, description, createdAt
- `PointRuleVO`: 积分规则说明对象

### 1.7 礼品商城 API

**新建文件：`api/gift.ts`**

- `GET /api/v1/gifts/list` - 获取礼品列表
    - 参数：`type?`, `status?`, `sortBy?` (查询参数，sortBy: points_asc/points_desc)
    - 返回：`Result<GiftVO[]>`

- `GET /api/v1/gifts/{giftId}` - 获取礼品详情
    - 返回：`Result<GiftVO>`

- `POST /api/v1/gifts/exchange` - 兑换礼品
    - 参数：`{ giftId: number, address?: string, contactPhone?: string }`
    - 返回：`Result<number>` (exchangeId)

- `GET /api/v1/gifts/my/exchanges` - 获取我的兑换记录
    - 返回：`Result<GiftExchangeVO[]>`

**数据模型：**
- `GiftVO`: giftId, name, description, image, points, type, typeName, stock, status
- `GiftExchangeVO`: exchangeId, giftId, giftName, giftImage, points, status, address?, contactPhone?, createdAt

### 1.8 活动中心 API

**新建文件：`api/activity.ts`**

- `GET /api/v1/activities/list` - 获取活动列表
    - 参数：`type?`, `status?` (查询参数)
    - 返回：`Result<ActivityVO[]>`

- `GET /api/v1/activities/{activityId}` - 获取活动详情
    - 返回：`Result<ActivityDetailVO>`

- `POST /api/v1/activities/{activityId}/join` - 报名活动
    - 返回：`Result<null>`

- `PUT /api/v1/activities/{activityId}/progress` - 更新活动进度
    - 参数：`{ progress: number }`
    - 返回：`Result<null>`

**数据模型：**
- `ActivityVO`: activityId, title, description, coverImage, type, typeName, startTime, endTime, rewardPoints, status, participantCount, isJoined
- `ActivityDetailVO`: 继承 ActivityVO，新增 userProgress, userStatus

---

## 二、页面改动说明

### 2.1 新增页面

**pages/booking/MyBookingsPage.vue** - 我的预约页面
- 使用 Tab 组件展示不同状态的预约（待确认、已确认、已完成）
- 调用 `GET /api/v1/bookings/my` 获取预约列表
- 支持取消预约功能（调用 `DELETE /api/v1/bookings/{bookingId}`）
- 显示预约信息：场馆名称、课程名称、预约时间、状态

**pages/booking/BookingCreatePage.vue** - 创建预约页面
- 场馆选择下拉框（调用场馆列表接口）
- 课程选择下拉框（可选，根据选择的场馆加载对应课程）
- 日期时间选择器（限制只能选择未来时间）
- 提交按钮（调用 `POST /api/v1/bookings`）

### 2.2 新增组件

**components/booking/BookingList.vue** - 预约列表组件
- 展示预约卡片列表
- 显示预约状态、时间、场馆/课程信息
- 支持取消操作

**components/review/CourseReviewForm.vue** - 课程评价表单
- 评分组件（1-5星）
- 评价内容输入框
- 提交按钮（调用 `POST /api/v1/courses/{courseId}/reviews`）

**components/review/ReviewList.vue** - 评价列表组件
- 展示评价列表（用户头像、昵称、评分、内容、时间）
- 支持分页加载
- 已评价用户可删除自己的评价

**components/discovery/RecommendedSection.vue** - 推荐课程区域
- 调用 `GET /api/v1/courses/recommended` 获取推荐课程
- 使用课程卡片展示

**components/discovery/PopularSection.vue** - 热门课程区域
- 调用 `GET /api/v1/courses/popular` 获取热门课程
- 使用课程卡片展示

### 2.3 修改现有页面

**pages/discovery/CourseDetailPage.vue**
- 在课程详情下方新增评价区域
- 如果用户未评价，显示评价表单组件
- 显示评价列表组件
- 如果课程关联场馆，添加"预约课程"按钮，跳转到预约创建页面

**pages/discovery/VenueDetailPage.vue**
- 添加场馆评价展示区域
- 添加"预约场馆"按钮
- 显示该场馆管理的课程列表

**pages/discovery/index.vue** (发现页)
- 在页面顶部或显眼位置添加"热门课程"区域
- 添加"为你推荐"区域
- 使用 `PopularSection` 和 `RecommendedSection` 组件

**pages/mine/ProfilePage.vue**
- 添加"我的预约"入口按钮或菜单项
- 点击后跳转到 `MyBookingsPage`

**pages/achievement/AchievementPage.vue** - 运动成就页面
- 展示用户累计运动成就数据
- 显示总里程、完成课程数、连续坚持天数、总积分、当前可用积分
- 使用卡片或图表形式展示各项成就
- 调用 `GET /api/v1/achievements/my` 获取数据

**pages/point/PointRecordPage.vue** - 积分记录页面
- 使用 Tab 展示"获得记录"和"消耗记录"
- 支持按类型筛选（运动、分享、活动、兑换）
- 支持按时间范围筛选
- 调用 `GET /api/v1/points/records` 获取记录列表
- 显示积分规则说明（调用 `GET /api/v1/points/rules`）

**pages/gift/GiftShopPage.vue** - 礼品商城页面
- 展示礼品列表，使用卡片布局
- 支持按类型筛选（实物、虚拟服务、APP权益）
- 支持按积分值排序（升序/降序）
- 显示礼品图片、名称、所需积分、库存
- 点击礼品卡片跳转到详情页

**pages/gift/GiftDetailPage.vue** - 礼品详情页面
- 显示礼品详细信息
- 显示所需积分和当前可用积分
- 兑换按钮（调用 `POST /api/v1/gifts/exchange`）
- 实物商品需要填写收货地址和联系电话

**pages/gift/MyExchangesPage.vue** - 我的兑换记录页面
- 展示用户兑换记录列表
- 显示兑换状态（待发货、已发货、已完成、已取消）
- 调用 `GET /api/v1/gifts/my/exchanges` 获取数据

**pages/activity/ActivityListPage.vue** - 活动列表页面
- 展示活动列表，使用卡片布局
- 支持按类型筛选（线上、线下、挑战赛、打卡任务）
- 支持按状态筛选（进行中、已结束）
- 显示活动封面、标题、时间、奖励积分、参与人数
- 显示"已报名"标识

**pages/activity/ActivityDetailPage.vue** - 活动详情页面
- 显示活动详细信息（标题、描述、时间、奖励等）
- 显示活动参与人数
- 显示用户参与状态和完成进度
- "立即报名"按钮（调用 `POST /api/v1/activities/{activityId}/join`）
- 打卡任务显示打卡按钮，更新进度（调用 `PUT /api/v1/activities/{activityId}/progress`）

### 2.4 新增组件

**components/achievement/AchievementCard.vue** - 成就卡片组件
- 展示单项成就数据（如总里程、完成课程数等）
- 使用图标和数字展示

**components/point/PointRecordItem.vue** - 积分记录项组件
- 展示单条积分记录
- 显示积分变化（正数绿色，负数红色）、类型、描述、时间

**components/gift/GiftCard.vue** - 礼品卡片组件
- 展示礼品信息
- 显示礼品图片、名称、所需积分、库存状态

**components/activity/ActivityCard.vue** - 活动卡片组件
- 展示活动信息
- 显示活动封面、标题、时间、奖励积分、参与人数、报名状态

### 2.5 修改现有页面

**pages/mine/ProfilePage.vue**
- 添加"运动成就"入口，跳转到 `AchievementPage`
- 添加"积分记录"入口，跳转到 `PointRecordPage`
- 添加"礼品商城"入口，跳转到 `GiftShopPage`
- 添加"活动中心"入口，跳转到 `ActivityListPage`
- 在页面顶部显示当前可用积分

**pages/home/HomePage.vue**
- 添加活动推荐区域，展示进行中的热门活动
- 添加积分余额显示

### 2.6 路由配置

**修改文件：`router/index.ts`**
- 新增路由：`/bookings` → `MyBookingsPage`，需要登录
- 新增路由：`/bookings/create` → `BookingCreatePage`，需要登录
- 新增路由：`/achievements` → `AchievementPage`，需要登录
- 新增路由：`/points/records` → `PointRecordPage`，需要登录
- 新增路由：`/gifts` → `GiftShopPage`，需要登录
- 新增路由：`/gifts/:giftId` → `GiftDetailPage`，需要登录
- 新增路由：`/gifts/exchanges` → `MyExchangesPage`，需要登录
- 新增路由：`/activities` → `ActivityListPage`，需要登录
- 新增路由：`/activities/:activityId` → `ActivityDetailPage`，需要登录

---

## 三、关键实现要点

1. **预约功能**：限制只能选择未来时间，检查时间冲突
2. **评价功能**：分页加载，支持删除自己的评价
3. **推荐展示**：热门课程基于评分、学习人数等排序；个性化推荐基于用户历史
4. **权限控制**：用户只能管理自己的预约和评价
5. **成就展示**：实时更新成就数据，使用图表或卡片展示
6. **积分记录**：支持按类型和时间筛选，区分获得和消耗记录
7. **礼品兑换**：检查积分是否足够，实物商品需要填写收货信息
8. **活动参与**：支持报名、进度更新，打卡任务每日更新进度

